本方法用于仿真环境下对cpu指令的运行进行查看，主要通过观察cpu相应模块的接口输出波形和数值进行判断。

1. 编写MIPS架构的汇编文件，文件中包含需要测试的指令

MIPS程序的基本模板如下：

```
# Comment giving name of program and description of function
# 说明下程序的目的和作用（其实和高级语言都差不多了）
# Template.s
#Bare-bones outline of MIPS assembly language program


           .data       # variable declarations follow this line
　　　　                # 数据变量声明
                       # ...

           .text       # instructions follow this line    
               # 代码段部分                                                            
main:                  # indicates start of code (first instruction to execute)
                       # 主程序
                       # ...

# End of program, leave a blank line afterwards to make SPIM happy
```

【十分钟教会你汇编】MIPS编程入门（妈妈说标题要高大上，才会有人看&gt;\_&lt;！） [https://www.cnblogs.com/thoupin/p/4018455.html](https://www.cnblogs.com/thoupin/p/4018455.html)



2. 将汇编程序进行编译链接

安装完成GNU工具链后，进入汇编文件所在目录输入如下指令进行编译链接

编译：`mips-sde-elf-as –mips32 inst_rom.S –o inst_rom.o`

链接：`mips-sde-elf-ld –T ram.ld inst_rom.o –o inst_rom.om`

2.2和2.3节主要对编译链接的背景知识进行详细的介绍



2.1 GNU工具链的安装

下载mips-sde-elf-i686-pc-linux-gnu.tar.tar（cpu组界面准备附件），将安装文件复制到Ubuntu的/opt目录下，打开Ubuntu的终端，使用如下命令解压缩。

`cd /opt`

`tar vfxj mips-sde-elf-i686-pc-linux-gnu.tar.tar`

然后打开用户主目录Home文件夹，在窗口菜单栏中选择View-&gt;Show Hidden Files，以显示所有文件，这样可以找到一个隐藏文件.bashrc，在此文件的最后加入 PATH 的设置，如下。

`export PATH=”$PATH:/opt/mips-4.3/bin”`

重新启动Ubuntu系统。

      重启后，打开终端，在其中输入mips-sde-elf-，然后按两次Tab键，会列出刚刚安装的，针对MIPS平台的所有编译工具，如图4-22所示，表示GNU工具链安装成功。

    

GNU工具链包含很多工具，但我们需要使用的不多，主要的几个工具如下。此处使用的是通用名，针对MIPS平台的工具，会在名称前增加“mips-sde-elf-”前缀。



 as：GNU汇编器，通常也称为GAS \(GNU Assembler\)，as对汇编源程序进行编译产生目标文件。

 ld：GNU链接器，as产生的目标文件需要由ld进行链接、重定位数据产生可执行文件。

 objcopy：用于将一种格式的目标文件复制成另外一种格式。

 objdump：用于列出关于二进制文件的各种信息。

 readelf：类似于objdump，但是它只能处理ELF格式的文件。

 

 2.2 使用GNU工具进行编译

 首先在Ubuntu虚拟机中新建一个文件以inst\_rom.S作为示范

 `.org 0x0          // 指示程序从地址0x0开始`

`.global _start    // 定义一个全局符号_start`

`.set noat         // 允许自由使用寄存器$1 `

`_start:`

`   ori $1,$0,0x1100        # $1 = $0 | 0x1100 = 0x1100`

`   ori $2,$0,0x0020        # $2 = $0 | 0x0020 = 0x0020`

`   ori $3,$0,0xff00        # $3 = $0 | 0xff00 = 0xff00`

`   ori $4,$0,0xffff        # $4 = $0 | 0xffff = 0xffff`

对“set noat”做进一步说明，这是一个汇编控制伪操作。寄存器$1，编程时的约定名称为at，一般留给汇编器使用，程序中不直接使用。如果直接使用，汇编器会发出警告，此处设置“set noat”就是表示可以自由使用寄存器$1，汇编器不会发出警告。

 

 在Ubuntu中打开终端，使用cd命令将路径调整到上述inst\_rom.S所在目录，然后使用如下命令编译代码。其中添加了“-mips32”选项，表示按照MIPS32指令集架构进行编译。

 `mips-sde-elf-as –mips32 inst_rom.S –o inst_rom.o`

